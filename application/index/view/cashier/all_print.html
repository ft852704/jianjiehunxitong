<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="_CSS_/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="_CSS_/bootstrap-responsive.css" />
    <link rel="stylesheet" type="text/css" href="_CSS_/style.css" />
    <script type="text/javascript" src="_JS_/jquery.js"></script>
    <script type="text/javascript" src="_JS_/bootstrap.js"></script>
    <script type="text/javascript" src="_JS_/ckform.js"></script>
    <script type="text/javascript" src="_JS_/common.js"></script>
    <script type="text/javascript" src="_LAYDATE_/laydate.js"></script>

    <style type="text/css">
        body {
            padding-bottom: 40px;
        }
        .sidebar-nav {
            padding: 9px 0;
        }

        @media (max-width: 980px) {
            /* Enable use of floated navbar text */
            .navbar-text.pull-right {
                float: none;
                padding-left: 5px;
                padding-right: 5px;
            }
        }
    </style>
</head>
<body>
<h3 style="margin-left:2%">消费单据合并打印</h3>
<form class="form-inline definewidth m20" action="" method="get">
			<select name="company">
			{foreach name="companylist" item='v' key='k'}
            <option value="{$v.id}"{if condition="$data.company_id==$v.id"}selected{/if}>{$v.full_name}</option>
            {/foreach}
            </select>
            开始日期<input type='text' name='start_time' id='start_time' value="{$data['start_time']}" />
            结束日期<input type='text' name='end_time' id='end_time' value="{$data['end_time']}" />
            单号<input type="text" name="number" value="{$data['number']}" />
    <button type="submit" class="btn btn-primary">查询</button>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <button type="button" class="btn btn-success" id="recharge">充值单据</button>
</form>
<form class="form-inline definewidth m20" action="{:URL('Cashier/dayin')}" method="get">
<table class="table table-bordered table-hover definewidth m10" style="float:left;width:40%;margin-left:4%" >
    <thead>
    <tr>
        <th style="width:5%">打印</th>
        <th style="width:10%">单号</th>
        <th style="width:10%">卡号</th>
        <th style="width:10%">姓名</th>
    </tr>
    </thead>
    	{php}foreach($list as $k => $v){{/php}
	     <tr>
            <td><label><input type="checkbox" value="{php}echo $v['id']{/php}" name="cashier_id[]" />&nbsp;&nbsp;&nbsp;</label></td>
	        <td>{php}echo $v['number']{/php}</td>
	        <td>{php}echo $v['member_no']{/php}</td>
	        <td>{php}echo $v['ctname']{/php}</td>
        </tr>
        {php}}{/php}
</table>
<table class="table table-bordered table-hover definewidth m10" style="float:right;width:40%;margin-right:4%" id="checkedcashier">
    <thead>
    <tr>
    <td colspan=7><center><button class="btn btn-primary" type="submit">打印</button></center></td>
    </tr>
    <tr>
        <th style="width:10%">名称</th>
        <th style="width:10%">支付方式</th>
        <th style="width:5%">折扣</th>
        <th style="width:5%">数量</th>
        <th style="width:5%">金额</th>
        <th style="width:5%">大工</th>
        <th style="width:5%">大工</th>
    </tr>
    </thead>
</table>
</form>
</body>
</html>
<script>
    $(function () {
        $("#recharge").click(function(){
			window.location.href = "{:URL('Cashier/print_rechange')}";
		});
        //日历使用2
		var start = {
		  elem: '#start_time',
		  event: 'focus',
		  format: 'YYYY-MM-DD hh:mm:ss', //日期格式
		  istime: true, //是否开启时间选择
		  max: laydate.now(), //最大日期
		  istoday: true,
		  choose: function(datas){
		     end.min = datas; //开始日选好后，重置结束日的最小日期
		     end.start = datas //将结束日的初始值设定为开始日
		  }
		};
		var end = {
		  elem: '#end_time',
		  event: 'focus',
		  format: 'YYYY-MM-DD hh:mm:ss', //日期格式
		  istime: true, //是否开启时间选择
		  max: laydate.now(),
		  istoday: true,
		  choose: function(datas){
		    start.max = datas; //结束日选好后，重置开始日的最大日期
		  }
		};
		laydate(start);
		laydate(end);

		$("input[type=checkbox]").click(function(){
			if($(this).is(':checked')){
				//获取子订单
				$.ajax({  
						type: 'POST',  
						dataType : "json",
						async:false,//是否异步请求
						url: "{:URL('Cashier/getCashiers')}",//请求的action路径页面
						data: {id:$(this).val()},  
						error: function(){ //请求失败处理函数
							alert('请求失败');  
						},
						success:function(data){ //请求成功后处理函数。
							if(data.sta==0){
								alert(data.msg);
							}else{
								var tbody = '';
								$.each(data.list, function(i, n) {
										var trs = "";
				                        trs += "<tr data-cashierid="+n.parent_id+"><td>"+n.services_name+"</td><td>"+n.pay+"</td><td>"+1+"</td><td>"+n.count+"</td><td>"+n.discount+"</td><td>"+n.fworker+"</td><td>"+n.sworker+"</td></tr>";
				                      	  tbody+=trs; 
				                });
				                 $("#checkedcashier").append(tbody);
							}
						}  
				});

			}else{
				$("[data-cashierid="+$(this).val()+"]").remove();
			}
		});
    });

</script>