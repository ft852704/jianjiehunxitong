<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <link rel="stylesheet" type="text/css" href="_CSS_/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="_CSS_/bootstrap-responsive.css" />
    <link rel="stylesheet" type="text/css" href="_CSS_/style.css" />
    <script type="text/javascript" src="_JS_/jquery.js"></script>
    <script type="text/javascript" src="_JS_/bootstrap.js"></script>
    <script type="text/javascript" src="_JS_/ckform.js"></script>
    <script type="text/javascript" src="_JS_/common.js"></script>
    <script type="text/javascript" src="_LAYDATE_/laydate.js"></script>
    <style type="text/css">
        body {
            padding-bottom: 40px;
        }
        .sidebar-nav {
            padding: 9px 0;
        }

        @media (max-width: 980px) {
            /* Enable use of floated navbar text */
            .navbar-text.pull-right {
                float: none;
                padding-left: 5px;
                padding-right: 5px;
            }
        }
        .checkboxtd label{
        	display: inline-block;;
        }


    </style>
</head>
<form action="" method="post">
<table class="table table-bordered table-hover definewidth m10">
    <tr>
        <td class="tableleft"></td>
        <td colspan="5">
        {php}if(in_array('membercard/batchopencard',$power)){{/php}
            <button type="submit" class="btn btn-primary" type="button">生成</button>&nbsp;&nbsp;
        {php}}{/php}
        <button type="reset" class="btn btn-primary" type="button">刷新</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-primary" type="button" id="detection">检测卡号是否被占用</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-success" id="list">已生成会员卡列表</button>
        </td>
    </tr>
    <tr>
        <td width="10%" class="tableleft" style="color:red">
        开始卡号
        </td>
        <td><input type="number" name="satart_no" required="required"/>请填写正整数</td>
        <td width="10%" class="tableleft" style="color:red">
        结束卡号
        </td>
        <td><input type="number" name="end_no" required="required"/>请填写正整数</td>
        <td width="10%" class="tableleft" style="color:red">
        卡号前缀
        </td>
        <td><input type="text" name="prefix_no"/></td>
    </tr>
    <tr>
        <td class="tableleft" style="color:red">会员卡类型</td>
        <td>
        	<select name="card_type">
        	{foreach name="ctlist" item='v' key='k'}
            <option value="{$v.id}">{$v.name}</option>
            {/foreach}
            </select>
        </td>
        <td width="10%" class="tableleft" style="color:red">所属公司</td>
        <td>
        	<select name="company">
        	{foreach name="comlist" item='v' key='k'}
            <option value="{$v.id}">{$v.full_name}</option>
            {/foreach}
            </select>
        </td>
        <td class="tableleft" style="color:red">卡可消费地区</td>
        <td>
        	<select name="company_area">
        	{foreach name="companylist" item='v' key='k'}
            <option value="{$k}">{$v}</option>
            {/foreach}
            </select>
        </td>
    </tr>
    <tr>
    	<td class="tableleft">是否跳过卡号带‘4’的卡</td>
        <td><label><input type='checkbox' name="exclude" value="1" checked="checked" />&nbsp;是</label></td>
    	<td class="tableleft">开卡日期</td>
        <td><input type='text' name='start_time' id='start_time' readonly value="{$time.stime}" /></td>
        <td class="tableleft">有效期至</td>
        <td><input type='text' name='end_time' id='end_time' readonly value="{$time.etime}" /></td>
    </tr>
    <tr>
        <td class="tableleft">手机号码</td>
        <td><input type="text" name="mobile_phone" /></td>
        <td width="10%" class="tableleft">会员姓名</td>
        <td>
        	<input type='text' name="name" />
        </td>
        <td class="tableleft">会员性别</td>
        <td>
        	<label><input type="radio" name="sex" value="1" checked/>男</label>
            <label><input type="radio" name="sex" value="2"/>女</label>
        </td>
    </tr>
    <tr>
        <td width="10%" class="tableleft">账户</td>
        <td>
        	电子钱包
        </td>
        <td class="tableleft">余额</td>
        <td><input type='number' name="ewallet" value=0 /></td>
        <td width="10%" class="tableleft"></td>
        <td></td>
    </tr>
    <tr>
        <td width="10%" class="tableleft">账户</td>
        <td>
        	储值账户
        </td>
        <td class="tableleft">余额</td>
        <td><input type='number' name="cash" value=0 /></td>
        <td width="10%" class="tableleft"></td>
        <td></td>
    </tr>
    <tr>
        <td width="10%" class="tableleft">账户</td>
        <td>
        	老疗程系统
        </td>
        <td class="tableleft">余额</td>
        <td><input type='number' name="old_cash" value=0 /></td>
        <td width="10%" class="tableleft"></td>
        <td></td>
    </tr>
</table>
</form>
</body>
</html>
<script>
    $(function () {  
    	$("#list").click(function(){
    		window.location.href="{:URL('member_card/batchCardList')}";
    	});
		$("[name=satart_no]").keyup(function(){  

	        $(this).val($(this).val().replace(/[^0-9.]/g,''));  

		    }).bind("paste",function(){ //CTR+V事件处理  $(this).val($(this).val().replace(/[^0-9.]/g,''));   

	    }).css("ime-mode", "disabled"); //CSS设置输入法不可用 
		$("[name=end_no]").keyup(function(){  

	        $(this).val($(this).val().replace(/[^0-9.]/g,''));  

		    }).bind("paste",function(){ //CTR+V事件处理  $(this).val($(this).val().replace(/[^0-9.]/g,''));   

	    }).css("ime-mode", "disabled"); //CSS设置输入法不可用 
		$("#detection").click(function(){
			var start = $("[name=satart_no]").val();
			var end = $("[name=end_no]").val();
			var prefix_no = $("[name=prefix_no]").val();
			if(start&&end){
				$.ajax({  
		   		type: 'POST',  
		   		dataType : "json",
		   		async:true,//是否异步请求
		   		url: "{:URL('member_card/checkCardNo')}",//请求的action路径页面
			   	data: {start:start,end:end,prefix_no:prefix_no},  
		   		error: function(){ //请求失败处理函数
		       		alert('请求失败');  
		   		},
		   		success:function(data){ //请求成功后处理函数。
		   			if(data.status==1){
		   				alert(data.msg);
		   				return false;
		   			}
				}
			});
		}
	});
    	//日历使用1
	    laydate({
	    	// //http://www.layui.com/doc/modules/laydate.html  官网  http://www.layui.com/laydate/
	    	elem: '#birthday', //需显示日期的元素选择器
		  	event: 'focus', //触发事件
		  //format: 'YYYY-MM-DD hh:mm:ss', //日期格式
		  	format: 'YYYY-MM-DD', //日期格式
		  //istime: false, //是否开启时间选择
		  //isclear: true, //是否显示清空
		  //istoday: true, //是否显示今天
		  //issure: true, //是否显示确认
		  //festival: true //是否显示节日
		  //min: '1900-01-01 00:00:00', //最小日期
		  max: laydate.now(), //最大日期
		  //start: '2014-6-15 23:00:00',  //开始日期
		 //fixed: false, //是否固定在可视区域
		  //zIndex: 99999999, //css z-index
		  //choose: function(dates){ //选择好日期的回调
		 
		 // }

		});
	    //日历使用2
		var start = {
		  elem: '#start_time',
		  event: 'focus',
		  format: 'YYYY/MM/DD',
		  min: laydate.now(), //设定最小日期为当前日期
		  max: '2099-06-16', //最大日期
		  istime: false,
		  istoday: true,
		  choose: function(datas){
		     end.min = datas; //开始日选好后，重置结束日的最小日期
		     end.start = datas //将结束日的初始值设定为开始日
		  }
		};
		var end = {
		  elem: '#end_time',
		  event: 'focus',
		  format: 'YYYY/MM/DD',
		  min: laydate.now(),
		  max: '2099-06-16 23:59:59',
		  istime: false,
		  istoday: false,
		  choose: function(datas){
		    start.max = datas; //结束日选好后，重置开始日的最大日期
		  }
		};
		laydate(start);
		laydate(end);


    	$("form").submit(function(e){
    		var start = $("[name=satart_no]").val();
			var end = $("[name=end_no]").val();
			var prefix_no = $("[name=prefix_no]").val();
			if(!start||!end){
				alert('请输入起始号码');
				return false;
			}
    		var out = false;
    		var total = 0;
    		$("[data=money]").each(function(){
			    if($(this).val()<=0){
			    	alert('请输入支付金额!');
			    	out = true;
			    	return false;
			    }
			    total = total+parseInt($(this).val());
			});
    		if(out){
    			return false;
    		}
 			if(!confirm('确认生成吗？')){
				return false;
			}
    	});
});

</script>
