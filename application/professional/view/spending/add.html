<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <link rel="stylesheet" type="text/css" href="_CSS_/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="_CSS_/bootstrap-responsive.css" />
    <link rel="stylesheet" type="text/css" href="_CSS_/style.css" />
    <script type="text/javascript" src="_JS_/jquery.js"></script>
    <script type="text/javascript" src="_JS_/bootstrap.js"></script>
    <script type="text/javascript" src="_JS_/ckform.js"></script>
    <script type="text/javascript" src="_JS_/common.js"></script>
    <script type="text/javascript" src="_LAYDATE_/laydate.js"></script>
    <style type="text/css">
        body {
            padding-bottom: 40px;
        }
        .sidebar-nav {
            padding: 9px 0;
        }

        @media (max-width: 980px) {
            /* Enable use of floated navbar text */
            .navbar-text.pull-right {
                float: none;
                padding-left: 5px;
                padding-right: 5px;
            }
        }
        .checkboxtd label{
        	display: inline-block;;
        }


    </style>
</head>
<form action="" method="post">
<table class="table table-bordered table-hover definewidth m10">
    <tr>
        <td class="tableleft"></td>
        <td colspan="3">
            <button type="submit" class="btn btn-primary" type="button">保存</button>&nbsp;&nbsp;<button type="reset" class="btn btn-primary" type="button">刷新</button>&nbsp;&nbsp;<button type="button" class="btn btn-success" id="backid">返回</button>
        </td>
    </tr>
    <tr>
        <td width="10%" class="tableleft">
        总金额</td>
        <td colspan=3><input type="text" value=0 readonly data="total"/><span style="color:red">总金额自动核算，仅需录入各项花销明细即可</span></td>
    </tr>
    <tr>
    	<td class="tableleft">经办人</td>
        <td><input type='text' name='manager' required="required"/></td>
        <td class="tableleft">支出日期</td>
        <td><input type='text' name="time" id='birthday' required="required" value="{$time}" /></td>
    </tr>
    <tr>
        <td colspan='4'>
        	<button type="button" class="btn btn-success" id="addpayway">增加支付方式</button>
        	<table class="table table-bordered table-hover definewidth m10">
        		<tbody id="payway">
	        		<tr>
		        		<th>支出科目</th>
		        		<th>金额</th>
		        		<th>备注</th>
	        		</tr>
	        		<tr>
	        			<td>
	        				<select name="type[]">
				        	{foreach name="spending_type" item='v' key='k'}
				            <option value="{$k}">{$v}</option>
				            {/foreach}
				            </select>
	        			</td>
	        			<td><input type='text' name="money[]" value=0 data='money' onchange="total(this)"required="required" /></td>
	        			<td><input type='text' name="remark[]" /></td>
	        			<td></td>
	        		</tr>
        		</tbody>
        	</tbale>
        </td>
    </tr>
</table>
</form>
</body>
</html>
<script>
    $(function () {  
    	//日历使用1
	    laydate({
	    	// //http://www.layui.com/doc/modules/laydate.html  官网  http://www.layui.com/laydate/
	    	elem: '#birthday', //需显示日期的元素选择器
		  	event: 'focus', //触发事件
		  //format: 'YYYY-MM-DD hh:mm:ss', //日期格式
		  format: 'YYYY-MM-DD hh:mm:ss', //日期格式
		  istime: true, //是否开启时间选择
		  //isclear: true, //是否显示清空
		  istoday: true, //是否显示今天
		  //issure: true, //是否显示确认
		  //festival: true //是否显示节日
		  //min: '1900-01-01 00:00:00', //最小日期
		  max: laydate.now(), //最大日期
		  //start: '2014-6-15 23:00:00',  //开始日期
		 //fixed: false, //是否固定在可视区域
		  //zIndex: 99999999, //css z-index
		  //choose: function(dates){ //选择好日期的回调
		 
		 // }

		});

    	$("form").submit(function(e){
    		var out = false;
    		var total = 0;
    		$("[data=money]").each(function(){
			    if($(this).val()<=0){
			    	alert('请输入支出金额!');
			    	out = true;
			    	return false;
			    }
			    total = total+parseInt($(this).val());
			});
    		if(out){
    			return false;
    		}
    		if(!confirm('确认添加支出吗？')){
				return false;
			}
		});

		$('#backid').click(function(){
				window.history.back();
		 });
    });
	$('#addpayway').click(function(){
		$("#payway").append($("#trstr").html());
	});
    function remv(obj){
    	$(obj).parent('td').parent('tr').remove();
    	total(obj);
    }
    function total(obj){
    	var total = 0;
    	$("[data=money]").each(function(){
			    total = total+parseInt($(this).val());
			});
    	$("[data=total]").val(total);
    }
</script>
<script type="text/html" id="trstr">
				<tr>
        			<td>
        				<select name="type[]">
			        	{foreach name="spending_type" item='v' key='k'}
			            <option value="{$k}">{$v}</option>
			            {/foreach}
			            </select>
        			</td>
        			<td><input type='text' name="money[]" value=0 data='money' onchange="total(this)" /></td>
        			<td><input type='text' name="remark[]" /></td>
        			<td><button type="button" style="font-size: 8px;" class="btn btn-default btn-xs" onclick="remv(this)">删除</button></td>
        		</tr>
</script>
